<!DOCTYPE html>
<html lang="it">

    <head>
        <meta charset="UTF-8" />
        <title>Trento nel seggio 2025</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="assets/vendor/bootstrap/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="assets/vendor/maplibre-gl/maplibre-gl.css" crossorigin="anonymous">
        <script src="assets/vendor/maplibre-gl/maplibre-gl.js" crossorigin="anonymous"></script>
        <script src="assets/vendor/pmtiles/pmtiles.js"></script>
        <script src="assets/vendor/protobufjs/protobuf.min.js"></script>
        <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
        <link href="https://fonts.googleapis.com" rel="preconnect">
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@400;700&family=Raleway:wght@400;700&display=swap"
            rel="stylesheet">
        <style>
            body,
            html {
                font-family: "Poppins", "Roboto", "Raleway", sans-serif;
                margin: 0;
                padding: 0;
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: column;
                background-color: hsl(240, 100%, 90%);
            }

            header,
            footer {
                background-color: #f8f9fa;
                padding: 10px;
                text-align: center;
                border-bottom: 1px solid #ddd;
            }

            footer {
                border-top: 1px solid #ddd;
                border-bottom: none;
            }

            main {
                flex: 1;
                display: flex;
                overflow: hidden;
                position: relative;
            }

            #sidebar-container {
                display: flex;
                flex-direction: column;
                background: #e9ecef;
                border-right: 1px solid #ccc;
                z-index: 20;
            }

            #sidebar-toggle {
                background: #007bff;
                color: white;
                border: none;
                width: 40px;
                padding: 10px 0;
                cursor: pointer;
            }

            #sidebar {
                width: 300px;
                background: #f8f9fa;
                border-right: 1px solid #ddd;
                overflow-y: auto;
                padding: 1rem;
                transition: max-width 0.3s ease, padding 0.3s ease;
                max-width: 300px;
            }

            #sidebar.hidden {
                max-width: 0;
                padding: 0;
                overflow: hidden;
            }

            #map {
                flex-grow: 1;
                height: 100%;
                width: 100%;
                transition: all 0.3s ease;
            }

            input:disabled {
                background-color: #e9ecef;
            }

            .maplibregl-control-container .maplibregl-ctrl-attrib {
                display: none !important;
            }

            footer {
                padding: 10px;
                text-align: left;
                border-top: 1px solid #ddd;
                position: relative;
            }
        </style>
    </head>

    <body>
        <!-- Modal Informazioni -->
        <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="infoModalLabel">Informazioni su Trento nel seggio 2025</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex mb-3">
                            <img src="assets/images/logo.png" alt="Logo Trento nel seggio" style="height: 64px; margin-right: 15px;">
                            <div>
                                <p><strong>Trento nel seggio 2025</strong> è un progetto realizzato da <a href="https://www.linkedin.com/in/napolnx/">Maurizio
                                        Napolitano</a> a solo scopo ludico, per sperimentare nuove modalità di
                                    visualizzazione dei dati elettorali in modo accessibile e interattivo.<br/>
                                Il codice sorgente è disponibile su <a href="https://github.com/napo/trentonelseggio2025">GitHub</a></p>
                            </div>
                        </div>
                        <p>I dati visualizzati provengono dal sito ufficiale del Comune di Trento:</p>
                        <p><a href="https://www.comune.trento.it/Aree-tematiche/Statistiche-e-dati-elettorali/Elettorale/Elezioni-amministrative-4-maggio-2025/Affluenze-e-risultati-elezioni-amministrative-4-maggio-2025"
                                target="_blank">
                                https://www.comune.trento.it/.../Affluenze-e-risultati-elezioni-amministrative-4-maggio-2025
                            </a></p>
                        <p>Le <strong>sezioni elettorali</strong> rappresentano l’insieme dei numeri civici associati a
                            ciascuna sezione. Questo non significa che ogni persona residente in quegli indirizzi abbia
                            votato: si tratta di una rappresentazione delle aree di riferimento per ogni sezione, sulla
                            base dei dati disponibili.</p>
                        <p>Il calcolo dei voti ai candidati sindaci e alle liste è fatto sulla base delle preferenze
                            espresse per i candidati di ciascuna lista, pertanto sono <strong>esclusi i voti diretti ai
                                soli candidati sindaci o alle liste senza preferenza</strong>.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal Cookie Policy -->
        <div class="modal fade" id="cookieModal" tabindex="-1" aria-labelledby="cookieModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cookieModalLabel">Cookie Policy</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                    </div>
                    <div class="modal-body">
                        <p>Questo sito <strong>non fa uso di cookie</strong>, né propri né di terze parti.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                    </div>
                </div>
            </div>
        </div>

        <header>
            <div class="d-flex justify-content-between align-items-center px-3">
                <div class="d-flex align-items-center gap-2">
                    <img src="assets/images/logo.png" alt="Logo Trento" style="height: 32px;">
                    <h1 class="h5 mb-0">Trento nel seggio 2025</h1>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#infoModal">ℹ️
                        Info</button>
                    <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                        data-bs-target="#cookieModal">Cookie Policy</button>
                </div>
            </div>
        </header>

        <main>
            <div id="sidebar-container">
                <button id="sidebar-toggle">☰</button>
            </div>
            <div id="sidebar">
                <h2 class="h6 mt-3">Mappa sezioni per candidato</h2>
                <div class="mb-3">
                    <label class="form-label">Scrivi il nome (sindaco, lista o candidato):</label>
                    <input type="text" id="mayor-input" class="form-control mt-2" list="mayor-datalist"
                        placeholder="Cerca sindaco...">
                    <datalist id="mayor-datalist"></datalist>
                    <input type="text" id="list-input" class="form-control mt-2" list="list-datalist"
                        placeholder="Cerca lista...">
                    <datalist id="list-datalist"></datalist>
                    <input type="text" id="candidate-input" class="form-control mt-2" list="candidate-datalist"
                        placeholder="Cerca candidato...">
                    <datalist id="candidate-datalist"></datalist>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="radio" name="view-mode" id="radio-sezioni" value="sezioni"
                            checked>
                        <label class="form-check-label" for="radio-sezioni">Sezioni</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="view-mode" id="radio-circoscrizioni"
                            value="circoscrizioni">
                        <label class="form-check-label" for="radio-circoscrizioni">Circoscrizioni</label>
                    </div>
                    <button id="reset-button" class="btn btn-secondary mt-2">Reset</button>
                </div>
                <div id="candidate-info" class="alert alert-light small"></div>
            </div>
            <div id="map"></div>
            <div id="legend" class="bg-light border p-2 rounded shadow-sm small"
                style="position: absolute; bottom: 10px; right: 10px; z-index: 30;">
                <strong>Quantità voti</strong><br>
                <div><span
                        style="display: inline-block; width: 12px; height: 12px; background: hsl(240, 100%, 90%); margin-right: 5px;"></span>
                    Pochi</div>
                <div><span
                        style="display: inline-block; width: 12px; height: 12px; background: hsl(240, 100%, 75%); margin-right: 5px;"></span>
                    Medi</div>
                <div><span
                        style="display: inline-block; width: 12px; height: 12px; background: hsl(240, 100%, 50%); margin-right: 5px;"></span>
                    Alti</div>
            </div>
        </main>
        <footer>
            <small>Open Data del Comune di Trento - Mappa: OpenFreeMap &copy; OpenMapTiles Data from <A
                    href="https://www.openstreetmap.org/copyright">OpenStreetMap</A> - made by <a
                    href="https://www.linkedin.com/in/napolnx/">napo</a></small>
        </footer>
        <script src="assets/vendor/bootstrap/bootstrap.bundle.min.js"></script>
        <script>
            // JavaScript per la mappa "Trento nel seggio 2025"
            const sidebar = document.getElementById("sidebar");
            const sidebarToggle = document.getElementById("sidebar-toggle");
            sidebarToggle.addEventListener("click", () => {
                const isHidden = sidebar.classList.toggle("hidden");
                sidebarToggle.textContent = isHidden ? "❯" : "☰";
                setTimeout(() => map.resize(), 310);
            });

            const protocol = new pmtiles.Protocol();
            maplibregl.addProtocol("pmtiles", protocol.tile);
            const map = new maplibregl.Map({
                container: "map",
                style: "https://tiles.openfreemap.org/styles/liberty",
                center: [11.121, 46.07],
                zoom: 10
            });
            map.addControl(new maplibregl.NavigationControl(), 'top-right');

            let hoverPopup = null;
            let currentCandidateId = null;
            const votesByCandidate = {};
            const candidateMeta = {};
            let allData = [], uniqueMayors = new Set(), uniqueLists = new Set(), uniqueCandidates = new Set();
            const districtVotesByType = { mayor: {}, list: {}, candidate: {} };

            function updateMapByFilter(type, value) {
                if (!value) return;
                const filtered = allData.filter(i => {
                    return type === "mayor" ? i.supportedmayor === value :
                        type === "list" ? i.group === value :
                            `${i.lastname} ${i.name}` === value;
                });
                const sectionVotes = {};
                filtered.forEach(i => {
                    sectionVotes[i.idSection] = (sectionVotes[i.idSection] || 0) + i.votes;
                });
                if (!Object.keys(sectionVotes).length) return;
                const maxVotes = Math.max(...Object.values(sectionVotes));
                const stops = Object.entries(sectionVotes).map(([id, v]) => {
                    let color = "hsl(240, 100%, 90%)";
                    const ratio = v / maxVotes;
                    if (ratio > 0.66) color = "hsl(240, 100%, 50%)";
                    else if (ratio > 0.33) color = "hsl(240, 100%, 75%)";
                    return [parseInt(id), color];
                });
                const opacityStops = Object.entries(sectionVotes).map(([id, v]) => [parseInt(id), v > 0 ? 0.6 : 0.0]);
                const idList = Object.keys(sectionVotes).map(k => parseInt(k));
                map.setPaintProperty("sezioni", "circle-color", ["match", ["get", "id_section"], ...stops.flat(), "#ccc"]);
                map.setFilter("sezioni", ["in", "id_section", ...idList]);
                map.setPaintProperty("sezioni", "circle-opacity", 0.6);
                map.setPaintProperty("sezioni", "circle-color", ["match", ["get", "id_section"], ...stops.flat(), "#ccc"]);
                map.setPaintProperty("sezioni", "circle-opacity", ["match", ["get", "id_section"], ...opacityStops.flat(), 0.0]);
                document.getElementById("mayor-input").disabled = type !== "mayor";
                document.getElementById("list-input").disabled = type !== "list";
                document.getElementById("candidate-input").disabled = type !== "candidate";
                const candidateInfo = document.getElementById("candidate-info");
                let infoHTML = "";
                if (type === "mayor") {
                    const totalVotes = filtered.reduce((sum, i) => sum + i.votes, 0);
                    const uniqueSections = new Set(filtered.map(i => i.idSection));
                    infoHTML = `<strong>${value}</strong><br>Voti totali: ${totalVotes}<br>Sezioni votate: ${uniqueSections.size}`;
                } else if (type === "list") {
                    const mayor = filtered[0].supportedmayor;
                    const totalVotes = filtered.reduce((sum, i) => sum + i.votes, 0);
                    const uniqueSections = new Set(filtered.map(i => i.idSection));
                    infoHTML = `<strong>${value}</strong><br>Sindaco: ${mayor}<br>Voti totali: ${totalVotes}<br>Sezioni votate: ${uniqueSections.size}`;
                } else if (type === "candidate" && filtered.length > 0) {
                    currentCandidateId = filtered[0].idCandidate;
                    const item = filtered[0];
                    const totalVotes = filtered.reduce((sum, i) => sum + i.votes, 0);
                    const uniqueSections = new Set(filtered.map(i => i.idSection));
                    const topSections = Object.entries(sectionVotes).sort((a, b) => b[1] - a[1]).slice(0, 3).map(([id, votes]) => {
                        const perc = ((votes / totalVotes) * 100).toFixed(1);
                        return `Sezione ${id}: ${votes} voti (${perc}%)`;
                    }).join("<br>");
                    infoHTML = `<strong>${item.lastname} ${item.name}</strong><br>Lista: ${item.group}<br>Sindaco: ${item.supportedmayor}<br>Voti totali: ${totalVotes}<br>Sezioni votate: ${uniqueSections.size}<br><br><strong>Top sezioni:</strong><br>${topSections}`;
                }
                candidateInfo.innerHTML = infoHTML;
            }

            function updateDistrictColors(type, value) {
                const districtVotes = districtVotesByType[type][value];
                if (!districtVotes) return;

                const maxVotes = Math.max(...Object.values(districtVotes));
                const colorStops = Object.entries(districtVotes).map(([id, v]) => {
                    let color = "hsl(240, 100%, 90%)";
                    const ratio = v / maxVotes;
                    if (ratio > 0.66) color = "hsl(240, 100%, 50%)";
                    else if (ratio > 0.33) color = "hsl(240, 100%, 75%)";
                    return [parseInt(id), color];
                });
                const opacityStops = Object.entries(districtVotes).map(([id, v]) => [
                    parseInt(id),
                    v > 0 ? 0.6 : 0.0
                ]);

                map.setPaintProperty("districts-layer", "fill-color",
                    ["match", ["get", "id_district"], ...colorStops.flat(), "#ccc"]
                );

                map.setPaintProperty("districts-layer", "fill-opacity",
                    ["match", ["get", "id_district"], ...opacityStops.flat(), 0.0]
                );

                // Fitting bounds dopo render
                map.once("idle", () => {
                    const ids = Object.keys(districtVotes).map(id => parseInt(id)).filter(id => districtVotes[id] > 0);
                    if (ids.length === 0) return;

                    const source = map.getSource("districts");
                    if (!source) return;

                    map.querySourceFeatures("districts", { sourceLayer: "districts" }).forEach(f => {
                        if (ids.includes(f.properties.id_district)) {
                            if (!map.__bbox) {
                                map.__bbox = turf.bbox(f);
                            } else {
                                map.__bbox = turf.bbox(turf.featureCollection([
                                    turf.bboxPolygon(map.__bbox),
                                    turf.bboxPolygon(turf.bbox(f))
                                ]));
                            }
                        }
                    });

                    if (map.__bbox) {
                        map.fitBounds(map.__bbox, { padding: 20 });
                        map.__bbox = null;
                    }
                });
            }

            map.on("load", () => {
                map.addSource("sections", { type: "vector", url: "pmtiles://sections.pmtiles" });
                map.addLayer({
                    id: "sezioni", type: "circle", source: "sections", "source-layer": "sections",
                    paint: {
                        "circle-color": "#ccc",
                        "circle-opacity": 0.0,
                        "circle-radius": ["interpolate", ["linear"], ["zoom"], 10, 1.5, 14, 3, 18, 6]
                    }, layout: { visibility: "visible" }
                });
                map.addSource("districts", { type: "vector", url: "pmtiles://districts.pmtiles" });
                map.addLayer({
                    id: "districts-layer", type: "fill", source: "districts", "source-layer": "districts",
                    paint: {
                        "fill-color": "rgba(0,0,0,0)",
                        "fill-outline-color": "rgba(0,0,255,0.8)"
                    }, layout: { visibility: "none" }
                });

                const radios = document.querySelectorAll('input[name="view-mode"]');
                function toggleLayerVisibility(view) {
                    if (view === "sezioni") {
                        map.setLayoutProperty("sezioni", "visibility", "visible");
                        map.setLayoutProperty("districts-layer", "visibility", "none");
                    } else if (view === "circoscrizioni") {
                        map.setLayoutProperty("sezioni", "visibility", "none");
                        map.setLayoutProperty("districts-layer", "visibility", "visible");
                    }
                }
                radios.forEach(radio => {
                    radio.addEventListener("change", e => toggleLayerVisibility(e.target.value));
                });
                toggleLayerVisibility("sezioni");


                protobuf.load("preferences_candidates.proto").then(root => {
                    const Msg = root.lookupType("Preferences_candidatesList");
                    return fetch("preferences_candidates.pbf")
                        .then(res => res.arrayBuffer())
                        .then(buf => {
                            const decoded = Msg.decode(new Uint8Array(buf));
                            allData = decoded.items.filter(item => item.votes > 0);
                            allData.forEach(item => {
                                const cid = item.idCandidate;
                                const idDist = item.idDistrict;
                                if (!votesByCandidate[cid]) votesByCandidate[cid] = {};
                                votesByCandidate[cid][item.idSection] = item.votes;
                                if (!districtVotesByType.mayor[item.supportedmayor]) districtVotesByType.mayor[item.supportedmayor] = {};
                                if (!districtVotesByType.mayor[item.supportedmayor][idDist]) districtVotesByType.mayor[item.supportedmayor][idDist] = 0;
                                districtVotesByType.mayor[item.supportedmayor][idDist] += item.votes;
                                if (!districtVotesByType.list[item.group]) districtVotesByType.list[item.group] = {};
                                if (!districtVotesByType.list[item.group][idDist]) districtVotesByType.list[item.group][idDist] = 0;
                                districtVotesByType.list[item.group][idDist] += item.votes;
                                const fullName = `${item.lastname} ${item.name}`;
                                if (!districtVotesByType.candidate[fullName]) districtVotesByType.candidate[fullName] = {};
                                if (!districtVotesByType.candidate[fullName][idDist]) districtVotesByType.candidate[fullName][idDist] = 0;
                                districtVotesByType.candidate[fullName][idDist] += item.votes;
                                candidateMeta[cid] = { id: cid, name: fullName, list: item.group, mayor: item.supportedmayor };
                                uniqueMayors.add(item.supportedmayor);
                                uniqueLists.add(item.group);
                                uniqueCandidates.add(fullName);
                            });
                            ["mayor", "list", "candidate"].forEach(type => {
                                const datalist = document.getElementById(`${type}-datalist`);
                                datalist.innerHTML = "";
                                const values = type === "mayor" ? [...uniqueMayors] : type === "list" ? [...uniqueLists] : [...uniqueCandidates];
                                values.sort().forEach(v => datalist.appendChild(new Option(v, v)));
                            });
                        });
                });
            });

            map.on("mousemove", "districts-layer", function (e) {
                map.getCanvas().style.cursor = "pointer";
                const props = e.features[0].properties;
                const idDistrict = parseInt(props.id_district);
                const name = props.district; // <-- correzione qui
                const mayorVal = document.getElementById("mayor-input").value;
                const listVal = document.getElementById("list-input").value;
                const candidateVal = document.getElementById("candidate-input").value;
                let popupContent = "";
                let totalVotes = 0;

                if (candidateVal && districtVotesByType.candidate[candidateVal]?.[idDistrict]) {
                    totalVotes = districtVotesByType.candidate[candidateVal][idDistrict];
                    popupContent = `<strong>${candidateVal}</strong><br>Circoscrizione: ${name}<br>Voti: ${totalVotes}`;
                } else if (listVal && districtVotesByType.list[listVal]?.[idDistrict]) {
                    totalVotes = districtVotesByType.list[listVal][idDistrict];
                    popupContent = `<strong>${listVal}</strong><br>Circoscrizione: ${name}<br>Voti: ${totalVotes}`;
                } else if (mayorVal && districtVotesByType.mayor[mayorVal]?.[idDistrict]) {
                    totalVotes = districtVotesByType.mayor[mayorVal][idDistrict];
                    popupContent = `<strong>${mayorVal}</strong><br>Circoscrizione: ${name}<br>Voti: ${totalVotes}`;
                }

                if (!totalVotes) return;

                if (!hoverPopup) hoverPopup = new maplibregl.Popup({ closeButton: false, closeOnClick: false });
                hoverPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
            });


            map.on("mouseleave", "districts-layer", () => {
                map.getCanvas().style.cursor = "";
                if (hoverPopup) { hoverPopup.remove(); hoverPopup = null; }
            });


            map.on("mousemove", "sezioni", function (e) {
                map.getCanvas().style.cursor = "pointer";
                const props = e.features[0].properties;
                const idSection = parseInt(props.id_section);
                const mayorVal = document.getElementById("mayor-input").value;
                const listVal = document.getElementById("list-input").value;
                const candidateVal = document.getElementById("candidate-input").value;
                let popupContent = "";
                let sectionVotes = [];

                if (candidateVal) {
                    sectionVotes = allData.filter(i => `${i.lastname} ${i.name}` === candidateVal && i.idSection === idSection);
                    if (sectionVotes.length > 0) {
                        const item = sectionVotes[0];
                        popupContent = `<strong>${item.lastname} ${item.name}</strong><br>
                      Lista: ${item.group}<br>
                      Sindaco: ${item.supportedmayor}<br>
                      Sezione: ${idSection}<br>
                      Voti: ${item.votes}`;
                    }
                } else if (listVal) {
                    sectionVotes = allData.filter(i => i.group === listVal && i.idSection === idSection);
                    const total = sectionVotes.reduce((sum, i) => sum + i.votes, 0);
                    if (total > 0) {
                        popupContent = `<strong>${listVal}</strong><br>
                      Sezione: ${idSection}<br>
                      Voti: ${total}`;
                    }
                } else if (mayorVal) {
                    sectionVotes = allData.filter(i => i.supportedmayor === mayorVal && i.idSection === idSection);
                    const total = sectionVotes.reduce((sum, i) => sum + i.votes, 0);
                    if (total > 0) {
                        popupContent = `<strong>${mayorVal}</strong><br>
                      Sezione: ${idSection}<br>
                      Voti: ${total}`;
                    }
                }

                if (!popupContent) return;
                if (!hoverPopup) hoverPopup = new maplibregl.Popup({ closeButton: false, closeOnClick: false });
                hoverPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
            });

            map.on("mouseleave", "sezioni", () => {
                map.getCanvas().style.cursor = "";
                if (hoverPopup) { hoverPopup.remove(); hoverPopup = null; }
            });


            ["mayor", "list", "candidate"].forEach(type => {
                document.getElementById(`${type}-input`).addEventListener("input", e => {
                    updateMapByFilter(type, e.target.value);
                    updateDistrictColors(type, e.target.value);
                });
            });

            document.getElementById("reset-button").addEventListener("click", () => {
                // Svuota gli input
                document.getElementById("mayor-input").value = "";
                document.getElementById("list-input").value = "";
                document.getElementById("candidate-input").value = "";

                // Riabilita tutti gli input
                document.getElementById("mayor-input").disabled = false;
                document.getElementById("list-input").disabled = false;
                document.getElementById("candidate-input").disabled = false;

                // Ripristina il contenuto del box informativo
                document.getElementById("candidate-info").innerHTML = "";

                // Rimuove il filtro e resetta i colori delle sezioni
                map.setFilter("sezioni", null);
                map.setPaintProperty("sezioni", "circle-color", "#ccc");
                map.setPaintProperty("sezioni", "circle-opacity", 0.0);

                // Reset colori distretti
                map.setPaintProperty("districts-layer", "fill-color", "rgba(0,0,0,0)");
                map.setPaintProperty("districts-layer", "fill-opacity", 0.0);

                // Reset visibilità: Sezioni visibili di default
                map.setLayoutProperty("sezioni", "visibility", "visible");
                map.setLayoutProperty("districts-layer", "visibility", "none");

                // Reset radio a "sezioni"
                document.getElementById("radio-sezioni").checked = true;

                // Zoom all'estensione massima dei distretti
                map.once("idle", () => {
                    const source = map.getSource("districts");
                    if (source?.type === "vector") {
                        map.fitBounds([
                            [10.99, 45.98],  // min lon, lat approssimativi
                            [11.25, 46.14]   // max lon, lat approssimativi
                        ], { padding: 20 });
                    }
                });
            });


        </script>

    </body>

</html>